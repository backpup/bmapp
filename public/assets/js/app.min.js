function suggestBookmarks(e){var t=e;if(e==="")t="all";var n=$.ajax({type:"GET",data:{keyword:t},url:"action/search",dataType:"json"}).done(function(e){var t=$("#bookmarks-body");t.empty();for(var n=0;n<e.length;n++){var r=buildRowFromObject(e[n]);t.append(r)}prepRows();renumberRows()})}var ratingWidget=function(e,t){var n=this;this.starCount=t||0;this.ratingList=e;this.listId=this.ratingList.attr("id");$.each(this.ratingList.find(".tara"),function(e,t){$(t).attr("id",n.listId+"_"+e).css("cursor","pointer").on("mouseover",function(){return n.rateOver(e)}).click(function(){return n.rateClick(e)})});this.ratingList.on("mouseout",$.proxy(this.rateOut,this))};ratingWidget.prototype.rateOver=function(e){for(var t=0;t<5;t++){if(t<=e){$("#"+this.listId+"_"+t).removeClass("fa-star-o").addClass("fa-star")}else{$("#"+this.listId+"_"+t).addClass("fa-star-o")}}};ratingWidget.prototype.rateClick=function(e){for(var t=0;t<5;t++){if(t<=e){$("#"+this.listId+"_"+t).removeClass("fa-star-o").addClass("fa-star");$("#"+this.listId+"_"+t).off()}$("#"+this.listId+"_"+t).off()}this.ratingList.off("mouseout");this.ratingList.attr("data-rating",e+1)};ratingWidget.prototype.rateOut=function(){for(var e=0;e<5;e++){if(e<this.starCount)$("#"+this.listId+"_"+e).removeClass("fa-star-o").addClass("fa-star");else $("#"+this.listId+"_"+e).removeClass("fa-star").addClass("fa-star-o")}};var Validator=function(e){this.msgExist=false;this.isValid=true;if(e.title.length<1){this.displayError("Title is required.");this.isValid=false;return}else if(/^[a-zA-Z _0-9-]+$/.test(e.title)===false){this.displayError("Only alphabets, numbers and dashes are valid");this.isValid=false;return}else if(e.link.length<1){this.displayError("Url is required");this.isValid=false;return}};Validator.prototype.displayError=function(e){var t=this;var n=$("#header-info");if(this.msgExist===true){clearTimeout(this.timeOut);n.html("")}else{n.html('<i class="fa fa-ban fa-lg"></i> '+e);t.msgExist=true;this.timeOut=setTimeout(function(){t.displayError()},3e3)}};var BookmarkGo=function(e){this.bmBody=$("#bookmarks-body");this.currentRow=e;this.init()};BookmarkGo.prototype.init=function(){var e=this;var t=this.currentRow;this.beingEdited=true;var n=t.children(".edit");t.children(".delete").on("click",function(){return e.bmDelete()});n.on("click",function(){return e.bmEdit()})};BookmarkGo.prototype.bmEdit=function(){var e=this;var t=this.currentRow.children();this.savedElements=t.clone(true);var n=new GroupManager;this.groupArray=n.getGroupArray();var r="";$.each(t,function(t,n){if($(n).hasClass("num")){var i=$("<div>").html('<i class="fa fa-cog fa-spin"></i>').addClass("actionIndicator num");i.attr("data-num",$(n).text());$(n).replaceWith(i)}else if($(n).is("a")){var s=$(this).children();var o=$("<input>").attr({type:"text","data-url":$(n).attr("href")}).addClass("title").val(s.html());r=$(n).attr("href");s.replaceWith(o);o.unwrap()}else if($(n).hasClass("stars")){var u=$(this).children(".ratingList");var a=u.data("rating");var f=u.attr("id");$(n).children().remove();var l=$("<span>").addClass("ratingList").attr("id","ratingList"+f).attr("data-rating",a);for(var c=0;c<5;c++){if(c<a)l.append($('<i class="fa tara fa-star"></i>'));else l.append($('<i class="fa tara fa-star-o"></i>'))}var h=new ratingWidget(l,a);$(n).append(l)}else if($(n).hasClass("edit")){var p=$(this);p.off();p.removeClass("blue").addClass("green").html('<i class="fa fa-save fa-lg">').click(function(){return e.saveEdit()})}else if($(n).hasClass("group")){var d=$(n).text().toUpperCase();var v=$("<select>").attr("name","groupSelect");for(var m=1;m<e.groupArray.length;m+=2){if(d==e.groupArray[m]){$("<option>").val(e.groupArray[m]).text(e.groupArray[m]).attr("selected",true).appendTo(v)}else{v.append($("<option>").val(e.groupArray[m]).text(e.groupArray[m]))}}$(n).text("").append(v)}else if($(n).hasClass("delete")){var g=$(this);g.off();var y=$('<i class="fa fa-minus-circle fa-lg">');g.text("").append(y).on("click",function(){return e.cancelEdit()})}});var i=$("<div>").html('<i class="fa fa-link"></i>').addClass("actionIndicator num");var s=$("<input>").attr({type:"text",name:"link"}).addClass("title").val(r);this.currentRow.append(i);this.currentRow.append(s)};BookmarkGo.prototype.cancelEdit=function(){this.currentRow.children().remove();this.currentRow.append(this.savedElements)};BookmarkGo.prototype.postEdit=function(){var e=this;var t=e.collectedInputs;var n=new Validator(t);if(!n.isValid){e.cancelEdit();return}var r=this.currentRow.attr("id").split("_")[1];var i=$.ajax({type:"POST",data:{id:r,title:t.title,link:t.link,group_id:t.group_id,stars:t.stars},url:"action/update"});i.done(function(){var n=buildRowFromObject(t);n.attr("id","bookmark_"+r);var i=new BookmarkGo(n);e.currentRow.replaceWith(n);renumberRows()});i.fail(function(){e.cancelEdit()})};BookmarkGo.prototype.saveEdit=function(){var e=this;this.collectedInputs={};$.each(this.currentRow.children(),function(t,n){var n=$(n);switch(t){case 1:{e.collectedInputs.title=n.val();break};case 2:{var r=n.children();var i=r.data("rating");r.children().off();e.collectedInputs.stars=i;break};case 3:{var s=n;var o=s.children().find("option:selected").val().toUpperCase();var u=e.groupArray.indexOf(o)-1;e.collectedInputs.group_id=parseInt(e.groupArray[u]);break};case 7:{e.collectedInputs.link=n.val();break};default:break}});e.postEdit()};BookmarkGo.prototype.bmDelete=function(){var e=this;var t=this.currentRow.attr("id").split("_")[1];var n=$.ajax({type:"POST",data:{id:t},url:"action/delete"}).done(function(){e.currentRow.remove();renumberRows()}).fail(function(){e.cancelEdit()})};var ToolBar=function(){this.toolBarChecker=true;this.grpBarChecker=true;this.addBtn=$("#bmAddBtn");this.grpAddBtn=$("#grpAddBtn");this.plusIcon=$('<i class="fa fa-plus fa-lg"></i>');this.minusIcon=$('<i class="fa fa-minus fa-lg"></i>');this.addBtn.on("click",$.proxy(this.addInputBar,this));this.grpAddBtn.on("click",$.proxy(this.initiateGrpAdd,this))};ToolBar.prototype.initiateGrpAdd=function(){var e=this;if(this.grpBarChecker){this.grpAddBtn.css({display:"none",zIndex:"-1"});e.grpFormSpan=$("<span>").addClass("grpForm").css("zIndex",10);var t=$("<input>").attr({type:"text",id:"newGrp",placeholder:"group name...",size:14}).addClass("grpInput").on("keyup",function(){var e=$(this).val();var t=/^[a-zA-Z\s_0-9]+$/.test(e);if(!t)$(this).val(e.substr(0,e.length-1));if(e.length>28){alert("Max-length allowed is 28");$(this).val(e.substr(0,28))}});var n=$("<span>").addClass("btn green").html('<i class="fa fa-save"></i>').click(function(){return e.groupSave()});var r=$("<span>").addClass("btn red").html('<i class="fa fa-trash-o"></i>').click(function(){e.grpFormSpan.css({display:"none",zIndex:"-1"});e.grpAddBtn.css({display:"",zIndex:"10"})});e.grpFormSpan.append(t).append(n).append(r);$("#header-controls").append(e.grpFormSpan);this.grpBarChecker=false}else{this.grpAddBtn.css({display:"none",zIndex:"-1"});$(".grpForm").css({display:"",zIndex:"10"}).find("input").val("")}};ToolBar.prototype.groupSave=function(){var e=$("#newGrp").val();if(e.length===0)return;var t=this;var n=$.ajax({type:"POST",url:"action/new-group",data:{group:e},dataType:"json"}).done(function(e){var n=$("<span>").attr("id","group_"+e.grpId).addClass("bookmarkGroups").text(e.group);$(".appInfo").append(n);t.grpFormSpan.css({display:"none",zIndex:"-1"});t.grpAddBtn.css({display:"",zIndex:"10"});var r=new RowManager})};ToolBar.prototype.addInputBar=function(){if(!this.toolBarChecker)return;var e=this;var t=new GroupManager;this.groupArray=t.getGroupArray();var n=$("<div>").addClass("row");var r=$("<div>").html('<i class="fa fa-cog fa-spin"></i>').addClass("actionIndicator num first");var i=$("<input>").attr({type:"text",name:"title",placeholder:"Title/description"}).addClass("title");var s=this.getNewRowCount()+1;var o=$("<span>").addClass("ratingList").attr("id","ratingList"+s);for(var u=0;u<5;u++){o.append($('<i class="fa tara fa-star-o"></i>'))}var a=new ratingWidget(o,0);var f=$("<span>").addClass("stars").append(o);var l=$("<span>").addClass("group");var c=$("<select>").attr("name","groupSelect");for(var h=0;h<this.groupArray.length;h++){if(h%2!==0)c.append($("<option>").val(this.groupArray[h]).text(this.groupArray[h]))}l.append(c);var p=$("<span>").addClass("btn green edit").html('<i class="fa fa-save fa-lg">').on("click",function(){return e.saveRowInput()});var d=$("<span>").addClass("btn red delete").text("").append($('<i class="fa fa-minus-circle fa-lg">')).click(function(){return e.delRowInput()});var v=$("<div>").html('<i class="fa fa-link"></i>').addClass("actionIndicator num");var m=$("<input>").attr({type:"text",name:"link",placeholder:"link.."}).addClass("title");n.append(r).append(i).append(f).append(l).append(p).append(d).append(v).append(m);$("#bookmarks-body").prepend(n);this.row=n;this.toolBarChecker=false};ToolBar.prototype.getNewRowCount=function(){var e=$(".row");if(e.length<1)return"1";else{return e.length}};ToolBar.prototype.saveRowInput=function(){this.collectedInputs={};var e=this;$.each(this.row.children(),function(t,n){var n=$(n);switch(t){case 1:{e.collectedInputs.title=n.val();break};case 2:{var r=n.children();r.children().off();var i=r.children(".fa-star").length;e.collectedInputs.stars=i;break};case 3:{var s=$(n);var o=s.children().find("option:selected").val().toUpperCase();var u=e.groupArray.indexOf(o)-1;e.collectedInputs.group_id=parseInt(e.groupArray[u]);break};case 7:{e.collectedInputs.link=n.val();break};default:break}});this.postSaveRowInput()};ToolBar.prototype.postSaveRowInput=function(){var e=this;var t=e.collectedInputs;var n=new Validator(t);if(!n.isValid){this.newRowToSave.remove();this.row.remove();this.addInputBar();e.toolBarChecker=true;return}var r=$.ajax({type:"POST",data:{title:t.title,link:t.link,stars:t.stars,group_id:t.group_id},url:"action/new"});r.done(function(n){var r=buildRowFromObject(t);r.attr("id","bookmark_"+n);e.row.replaceWith(r);e.toolBarChecker=true;var i=new BookmarkGo(r);var s=new RowManager;var o=true;renumberRows()})};ToolBar.prototype.delRowInput=function(){this.row.remove();this.toolBarChecker=true};var GroupManager=function(){var e=this;this.groupArray=[];$.each($("span.bookmarkGroups"),function(t,n){var r=$(n).attr("id").split("_")[1];var i=$(n).text().toUpperCase();e.groupArray.push(r);e.groupArray.push(i)})};GroupManager.prototype.getGroupArray=function(){return this.groupArray};var RowManager=function(){var e=new GroupManager;this.groupArray=e.getGroupArray();this.filteredList=[];this.init()};RowManager.prototype.init=function(){var e=$("#groupSelect");e.children(":not(:first)").remove();$.each($(".bookmarkGroups"),function(t,n){var r=$(n).text();$("<option>").attr("val",r).text(r).appendTo(e)})};RowManager.prototype.filter=function(e){var t=this;var n=this.groupArray.indexOf(e.toUpperCase());if(e.toUpperCase()=="Group".toUpperCase())var r="all";else var r=this.groupArray[n-1];var i=$.ajax({type:"GET",url:"action/filter-by-group",data:{group_id:r},dataType:"json"}).done(function(e){var t=$("#bookmarks-body");t.empty();for(var n=0;n<e.length;n++){var r=buildRowFromObject(e[n]);t.append(r)}prepRows();renumberRows()})};$("#searchIconId").click(function(){var e=$("#searchForm");e.toggleClass("expandwidth");var t=$("#search");t.on("keyup",function(){var e=$(this).val();suggestBookmarks(e)})});var rowMgInitialize=new RowManager;$("#groupSelect").on("change",function(){var e=$(this).find("option:selected").val();rowMgInitialize.filter(e)});$("#filterIconId").click(function(){$("#filterBox").toggleClass("expandFilter")});var prepRows=function(){var e=0;$.each($(".row"),function(t,n){var r=new BookmarkGo($(n));e++});return e};var renumberRows=function(){$.each($("#bookmarks-body").children(".row"),function(e,t){var n=$(this);var r=e+1;n.find(".num").text(r+".")})};var buildRowFromObject=function(e){var t=new GroupManager;var n=t.getGroupArray();var r=$("<div>").addClass("row").attr("id","bookmark_"+e.id);$("<span>").addClass("num").appendTo(r);var i=$("<span>").addClass("title").text(e.title);$("<a>").attr({href:e.link,target:"_blank"}).append(i).appendTo(r);var s=parseInt(e.stars);var o=$("<span>").addClass("ratingList").attr("id","ratingList"+e.id).attr("data-rating",s);for(var u=0;u<5;u++){if(u<s)o.append($('<i class="fa tara fa-star"></i>'));else o.append($('<i class="fa tara fa-star-o"></i>'))}$("<span>").addClass("stars").append(o).appendTo(r);var a=e.group_id.toString();var f=n.indexOf(a)+1;$("<span>").addClass("group").text(n[f]).appendTo(r);$("<span>").addClass("btn blue edit").html('<i class="fa fa-edit fa-lg">').appendTo(r);$("<span>").addClass("btn red delete").html('<i class="fa fa-trash-o">').appendTo(r);return r};$(document).ready(function(){var e=prepRows();var t=new ToolBar;if(e===0)$("#bmAddBtn").trigger("click");var n=new GroupManager;(function(){$(".intro").on("mouseover",function(){$(this).find(".headerLogo").html('<i class="fa fa-star"></i>')}).on("mouseout",function(){$(this).find(".headerLogo").html('<i class="fa fa-star-o"></i>')})})()})