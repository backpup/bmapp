function suggestBookmarks(a){var t=a;""===a&&(t="all");$.ajax({type:"GET",data:{keyword:t},url:"action/search",dataType:"json"}).done(function(a){var t=$("#bookmarks-body");t.empty();for(var r=0;r<a.length;r++){var e=buildRowFromObject(a[r]);t.append(e)}prepRows(),renumberRows()})}var ratingWidget=function(a,t){var r=this;this.starCount=2==arguments.length?t:0,this.ratingList=a,this.listId=this.ratingList.attr("id"),$.each(this.ratingList.find(".tara"),function(a,t){$(t).attr("id",r.listId+"_"+a).css("cursor","pointer"),$(t).on("mouseover",function(){return r.rateOver(a)}),$(t).click(function(){return r.rateClick(a)})}),this.ratingList.on("mouseout",$.proxy(this.rateOut,this))};ratingWidget.prototype.rateOver=function(a){for(var t=0;5>t;t++)a>=t?$("#"+this.listId+"_"+t).removeClass("fa-star-o").addClass("fa-star"):$("#"+this.listId+"_"+t).addClass("fa-star-o")},ratingWidget.prototype.rateClick=function(a){for(var t=0;5>t;t++)a>=t&&($("#"+this.listId+"_"+t).removeClass("fa-star-o").addClass("fa-star"),$("#"+this.listId+"_"+t).off()),$("#"+this.listId+"_"+t).off();this.ratingList.off("mouseout"),this.ratingList.attr("data-rating",a+1)},ratingWidget.prototype.rateOut=function(){for(var a=0;5>a;a++)a<this.starCount?$("#"+this.listId+"_"+a).removeClass("fa-star-o").addClass("fa-star"):$("#"+this.listId+"_"+a).removeClass("fa-star").addClass("fa-star-o")};var Validator=function(a,t){this.msgExist=!1,this.isValid=!0;var r=0;r=t?1:2;for(var e=0;r>e;e++)switch(e){case 0:if(a[0].length<1)return this.displayError("Title is required."),void(this.isValid=!1);if(/^[a-zA-Z _0-9-]+$/.test(a[0])===!1)return this.displayError("Only alphabets, numbers and dashes are valid"),void(this.isValid=!1);break;case 1:if(a[1].length<1)return this.displayError("Url is required."),void(this.isValid=!1)}};Validator.prototype.displayError=function(a){var t=this,r=$("#header-info");this.msgExist===!0?(clearTimeout(this.timeOut),r.html("")):(r.html('<i class="fa fa-ban fa-lg"></i> '+a),t.msgExist=!0,this.timeOut=setTimeout(function(){t.displayError()},3e3))};var BookmarkGo=function(a){this.bmBody=$("#bookmarks-body"),this.currentRow=a,this.init()};BookmarkGo.prototype.init=function(){var a=this,t=this.currentRow;this.beingEdited=!0;var r=t.children(".edit");t.children(".delete").on("click",function(){return a.bmDelete()}),r.on("click",function(){return a.bmEdit()})},BookmarkGo.prototype.bmEdit=function(){var a=this,t=this.currentRow.children();this.savedElements=t.clone(!0);var r=new GroupManager;this.groupArray=r.getGroupArray();var e="";$.each(t,function(t,r){if($(r).hasClass("num")){var n=$("<div>").html('<i class="fa fa-cog fa-spin"></i>').addClass("actionIndicator num");n.attr("data-num",$(r).text()),$(r).replaceWith(n)}else if($(r).is("a")){var s=$(this).children(),i=$("<input>").attr({type:"text","data-url":$(r).attr("href")}).addClass("title").val(s.html());e=$(r).attr("href"),s.replaceWith(i),i.unwrap()}else if($(r).hasClass("stars")){var o=$(this).children(".ratingList"),d=o.data("rating"),p=o.attr("id");$(r).children().remove();for(var l=$("<span>").addClass("ratingList").attr("id","ratingList"+p).attr("data-rating",d),c=0;5>c;c++)l.append(d>c?$('<i class="fa tara fa-star"></i>'):$('<i class="fa tara fa-star-o"></i>'));{new ratingWidget(l,d)}$(r).append(l)}else if($(r).hasClass("edit")){var u=$(this);u.off(),u.removeClass("blue").addClass("green").html('<i class="fa fa-save fa-lg">').click(function(){return a.saveEdit()})}else if($(r).hasClass("group")){for(var h=$(r).text().toUpperCase(),f=$("<select>").attr("name","groupSelect"),g=0;g<a.groupArray.length;g++)g%2!==0&&(h==a.groupArray[g]?$("<option>").val(a.groupArray[g]).text(a.groupArray[g]).attr("selected",!0).appendTo(f):f.append($("<option>").val(a.groupArray[g]).text(a.groupArray[g])));$(r).text("").append(f)}else if($(r).hasClass("delete")){var v=$(this);v.off();var m=$('<i class="fa fa-minus-circle fa-lg">');v.text("").append(m).on("click",function(){return a.cancelEdit()})}});var n=$("<div>").html('<i class="fa fa-link"></i>').addClass("actionIndicator num"),s=$("<input>").attr({type:"text",name:"link"}).addClass("title").val(e);this.currentRow.append(n),this.currentRow.append(s)},BookmarkGo.prototype.cancelEdit=function(){this.currentRow.children().remove(),this.currentRow.append(this.savedElements)},BookmarkGo.prototype.postEdit=function(){var a=this,t=a.collectedInputs,r=new Validator(t);if(!r.isValid)return void a.cancelEdit();var e=this.currentRow.attr("id").split("_")[1],n=$.ajax({type:"POST",data:{id:e,title:t[0],link:t[1],group_id:t[3],stars:t[2]},url:"action/update"});n.done(function(){a.currentRow.children().last().remove(),a.currentRow.children().last().remove()}),n.fail(function(){a.cancelEdit()})},BookmarkGo.prototype.saveEdit=function(){var a=this;a.collectedInputs=[],$.each(this.currentRow.children(),function(t,r){var r=$(r);switch(t){case 0:var e=r.data("num"),n=$("<span>").attr("data-num",e).addClass("num").text(e);r.replaceWith(n);break;case 1:a.collectedInputs.push(r.val());var s=a.currentRow.children(".title").last().val(),i=$("<span>").addClass("title").text(r.val()),o=$("<a>").attr({href:s,target:"_blank"});o.append(i),r.replaceWith(o),a.collectedInputs.push(s);break;case 2:{var d=r.children();d.data("rating")}d.children().off(),a.collectedInputs.push(d.data("rating"));break;case 3:var p=$(r),l=p.children().find("option:selected").val().toUpperCase(),c=a.groupArray.indexOf(l)-1;p.text(l),a.collectedInputs.push(parseInt(a.groupArray[c]));break;case 4:r.off(),r.removeClass("green").addClass("blue").html('<i class="fa fa-edit fa-lg">').click(function(){return a.bmEdit()});break;case 5:r.off();var u=$('<i class="fa fa-trash-o">');r.text("").append(u).click(function(){return a.bmDelete()})}}),a.postEdit()},BookmarkGo.prototype.bmDelete=function(){{var a=this,t=this.currentRow.attr("id").split("_")[1];$.ajax({type:"POST",data:{id:t},url:"action/delete"}).done(function(){a.currentRow.remove(),renumberRows()}).fail(function(){a.cancelEdit()})}};var ToolBar=function(){this.toolBarChecker=!0,this.grpBarChecker=!0,this.addBtn=$("#bmAddBtn"),this.grpAddBtn=$("#grpAddBtn"),this.plusIcon=$('<i class="fa fa-plus fa-lg"></i>'),this.minusIcon=$('<i class="fa fa-minus fa-lg"></i>'),this.addBtn.on("click",$.proxy(this.addInputBar,this)),this.grpAddBtn.on("click",$.proxy(this.initiateGrpAdd,this))};ToolBar.prototype.initiateGrpAdd=function(){var a=this;if(this.grpBarChecker){this.grpAddBtn.css({display:"none",zIndex:"-1"}),a.grpFormSpan=$("<span>").addClass("grpForm").css("zIndex",10);var t=$("<input>").attr({type:"text",id:"newGrp",placeholder:"group name...",size:14}).addClass("grpInput").on("keyup",function(){var a=$(this).val(),t=/^[a-zA-Z\s_0-9]+$/.test(a);t||$(this).val(a.substr(0,a.length-1)),a.length>28&&(alert("Max-length allowed is 28"),$(this).val(a.substr(0,28)))}),r=$("<span>").addClass("btn green").html('<i class="fa fa-save"></i>').click(function(){return a.groupSave()}),e=$("<span>").addClass("btn red").html('<i class="fa fa-trash-o"></i>').click(function(){a.grpFormSpan.css({display:"none",zIndex:"-1"}),a.grpAddBtn.css({display:"",zIndex:"10"})});a.grpFormSpan.append(t).append(r).append(e),$("#header-controls").append(a.grpFormSpan),this.grpBarChecker=!1}else this.grpAddBtn.css({display:"none",zIndex:"-1"}),$(".grpForm").css({display:"",zIndex:"10"}).find("input").val("")},ToolBar.prototype.groupSave=function(){var a=$("#newGrp").val();if(0!==a.length){var t=this;$.ajax({type:"POST",url:"action/new-group",data:{group:a},dataType:"json"}).done(function(a){var r=$("<span>").attr("id","group_"+a.grpId).addClass("bookmarkGroups").text(a.group);$(".appInfo").append(r),t.grpFormSpan.css({display:"none",zIndex:"-1"}),t.grpAddBtn.css({display:"",zIndex:"10"});new RowManager})}},ToolBar.prototype.addInputBar=function(){if(this.toolBarChecker){var a=this,t=new GroupManager;this.groupArray=t.getGroupArray();for(var r=$("<div>").addClass("row"),e=$("<div>").html('<i class="fa fa-cog fa-spin"></i>').addClass("actionIndicator num first"),n=$("<input>").attr({type:"text",name:"title",placeholder:"Title/description"}).addClass("title"),s=this.getNewRowCount()+1,i=$("<span>").addClass("ratingList").attr("id","ratingList"+s),o=0;5>o;o++)i.append($('<i class="fa tara fa-star-o"></i>'));for(var d=(new ratingWidget(i,0),$("<span>").addClass("stars").append(i)),p=$("<span>").addClass("group"),l=$("<select>").attr("name","groupSelect"),c=0;c<this.groupArray.length;c++)c%2!==0&&l.append($("<option>").val(this.groupArray[o]).text(this.groupArray[o]));p.append(l);var u=$("<span>").addClass("btn green edit").html('<i class="fa fa-save fa-lg">').on("click",function(){return a.saveRowInput()}),h=$("<span>").addClass("btn red delete").text("").append($('<i class="fa fa-minus-circle fa-lg">')).click(function(){return a.delRowInput()}),f=$("<div>").html('<i class="fa fa-link"></i>').addClass("actionIndicator num"),g=$("<input>").attr({type:"text",name:"link",placeholder:"link.."}).addClass("title");r.append(e).append(n).append(d).append(p).append(u).append(h).append(f).append(g),$("#bookmarks-body").prepend(r),this.row=r,this.toolBarChecker=!1}},ToolBar.prototype.getNewRowCount=function(){var a=$(".row");return a.length<1?"1":a.length},ToolBar.prototype.saveRowInput=function(){this.collectedInputArray=[];var a=this;a.newRowToSave=$("<div>").addClass("row");var t=this.row.children().last().val(),r=a.getNewRowCount()+".";$.each(this.row.children(),function(e,n){var n=$(n);switch(e){case 0:var s=$("<span>").addClass("num").text(r);a.newRowToSave.append(s);break;case 1:a.collectedInputArray.push(n.val()),a.collectedInputArray.push(t);var i=$("<span>").addClass("title").text(n.val()),o=$("<a>").attr({href:t,target:"_blank"});o.append(i),a.newRowToSave.append(o);break;case 2:var d=n.children();d.children().off();var p=d.children(".fa-star").length;a.collectedInputArray.push(p),d.attr("data-rating",p),$("<span>").addClass("stars").append(d).appendTo(a.newRowToSave);break;case 3:var l=$(n),c=l.children().find("option:selected").val().toUpperCase(),u=a.groupArray.indexOf(c)-1;a.collectedInputArray.push(parseInt(a.groupArray[u])),$("<span>").addClass("group").text(c).appendTo(a.newRowToSave);break;case 4:$(n).off().html('<i class="fa fa-edit fa-lg">').removeClass("green").addClass("blue").appendTo(a.newRowToSave);break;case 5:$(n).off().text("").html('<i class="fa fa-trash-o">').appendTo(a.newRowToSave)}}),this.postSaveRowInput()},ToolBar.prototype.postSaveRowInput=function(){var a=this,t=a.collectedInputArray,r=new Validator(t);if(!r.isValid)return this.newRowToSave.remove(),this.row.remove(),this.addInputBar(),void(a.toolBarChecker=!0);var e=$.ajax({type:"POST",data:{title:t[0],link:t[1],stars:t[2],group_id:t[3]},url:"action/new"});e.done(function(t){a.newRowToSave.attr("id","bookmark_"+t),a.row.replaceWith(a.newRowToSave),a.toolBarChecker=!0;new BookmarkGo(a.newRowToSave),new RowManager;renumberRows()})},ToolBar.prototype.delRowInput=function(){this.row.remove(),this.toolBarChecker=!0};var GroupManager=function(){var a=this;this.groupArray=[],$.each($("span.bookmarkGroups"),function(t,r){var e=$(r).attr("id").split("_")[1],n=$(r).text().toUpperCase();a.groupArray.push(e),a.groupArray.push(n)})};GroupManager.prototype.getGroupArray=function(){return this.groupArray};var savedRowList=$("#bookmarks-body").children(".row"),RowManager=function(){var a=new GroupManager;this.groupArray=a.getGroupArray(),this.filteredList=[],this.init()};RowManager.prototype.init=function(){var a=$("#groupSelect");a.children(":not(:first)").remove(),$.each($(".bookmarkGroups"),function(t,r){var e=$(r).text();$("<option>").attr("val",e).text(e).appendTo(a)})},RowManager.prototype.filter=function(a){var t=this.groupArray.indexOf(a.toUpperCase());if(a.toUpperCase()=="Group".toUpperCase())var r="all";else var r=this.groupArray[t-1];$.ajax({type:"GET",url:"action/filter-by-group",data:{group_id:r},dataType:"json"}).done(function(a){var t=$("#bookmarks-body");t.empty();for(var r=0;r<a.length;r++){var e=buildRowFromObject(a[r]);t.append(e)}prepRows(),renumberRows()})},$("#searchIconId").click(function(){var a=$("#searchForm");a.toggleClass("expandwidth");var t=$("#search");t.on("keyup",function(){var a=$(this).val();return suggestBookmarks(a)})});var rowMgInitialize=new RowManager;$("#groupSelect").on("change",function(){var a=$(this).find("option:selected").val();rowMgInitialize.filter(a)}),$("#filterIconId").click(function(){$("#filterBox").toggleClass("expandFilter")});var prepRows=function(){var a=0;return $.each($(".row"),function(t,r){new BookmarkGo($(r));a++}),a},renumberRows=function(){$.each($("#bookmarks-body").children(".row"),function(a){var t=$(this),r=a+1;t.find(".num").text(r+".")})},buildRowFromObject=function(a){var t=new GroupManager,r=t.getGroupArray(),e=$("<div>").addClass("row").attr("id","bookmark_"+a.id);$("<span>").addClass("num").appendTo(e);var n=$("<span>").addClass("title").text(a.title);$("<a>").attr({href:a.link,target:"_blank"}).append(n).appendTo(e);for(var s=parseInt(a.stars),i=$("<span>").addClass("ratingList").attr("id","ratingList"+a.id).attr("data-rating",s),o=0;5>o;o++)i.append(s>o?$('<i class="fa tara fa-star"></i>'):$('<i class="fa tara fa-star-o"></i>'));new ratingWidget(i,s);$("<span>").addClass("stars").append(i).appendTo(e);var d=r.indexOf(a.group_id)+1;return $("<span>").addClass("group").text(r[d]).appendTo(e),$("<span>").addClass("btn blue edit").html('<i class="fa fa-edit fa-lg">').appendTo(e),$("<span>").addClass("btn red delete").html('<i class="fa fa-trash-o">').appendTo(e),e};!function(){$(".intro").on("mouseover",function(){$(this).find(".headerLogo").html('<i class="fa fa-star"></i>')}).on("mouseout",function(){$(this).find(".headerLogo").html('<i class="fa fa-star-o"></i>')})}(),$(document).ready(function(){{var a=prepRows();new ToolBar}0===a&&$("#bmAddBtn").trigger("click");new GroupManager});